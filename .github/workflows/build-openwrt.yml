name: Build OpenWrt

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v2

      - name: Install build dependencies
        run: |
          sudo apt update
          sudo apt install -y build-essential clang flex bison g++ gawk gcc-multilib \
          g++-multilib gettext git libncurses5-dev libssl-dev python3-distutils \
          rsync unzip zlib1g-dev file wget libelf-dev ecj fastjar java-propose-classpath

      - name: Initialize feeds and install packages
        run: |
          ./scripts/feeds update -a
          ./scripts/feeds install -a

      - name: Load default config and download sources
        run: |
          make defconfig
          make -j$(nproc) download

      - name: Build OpenWrt
        run: |
          make -j$(nproc) V=s
